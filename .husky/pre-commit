echo "Running pre-commit checks..."

# Run ESLint
echo "Running ESLint..."
npm run lint || {
    echo "❌ ESLint check failed. Please fix the errors and try committing again."
    exit 1
}

# Run Prettier
echo "Running Prettier..."
npm run format || {
    echo "❌ Prettier check failed. Run 'npm run format:fix' to automatically fix formatting issues."
    exit 1
}

echo "Running tests..."
npm run pretest
npm run test:integration || {
    # At least one check suggests we're in a terminal
    if [ -t 1 ] || [ -t 2 ] || [ -t 0 ] || [ -n "$TERM" ]; then
        echo "Tests failed. Do you wish to commit anyway (y/n)?"
        exec < /dev/tty
        read -r reply
        case "$reply" in
        [Yy]) ;; # Continue
        *) exit 1 ;; # Fail
        esac
    else
        echo "❌ Tests failed and not running in interactive terminal."
        echo "Ignoring failure."
    fi
}

echo "✅ All checks passed!"
